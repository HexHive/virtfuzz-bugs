# An abort was just triggered in audio_calloc

## More details

### Hypervisor, hypervisor version, upstream commit/tag, host
qemu, 6.2.50, aeb0ae95b7f18c66158792641cb6ba0cde5789ab, Ubuntu 18.04

### VM architecture, device, device type
i386, ac97, audio

### Bug Type: Abort

### Stack traces, crash details

```
==8121==WARNING: ASan doesn't fully support makecontext/swapcontext functions and may produce false positives in some cases!
INFO: found LLVMFuzzerCustomMutator (0x560b571044d0). Disabling -len_control by default.
INFO: Running with entropic power schedule (0xFF, 100).
INFO: Seed: 2701193234
INFO: Loaded 1 modules   (912158 inline 8-bit counters): 912158 [0x560b5e8bb000, 0x560b5e999b1e), 
INFO: Loaded 1 PC tables (912158 PCs): 912158 [0x560b5dacfbb0,0x560b5e8bad90),
./qemu-fuzz-i386-target-videzzo-fuzz-ac97: Running 1 inputs 1 time(s) each.
INFO: Reading pre_seed_input if any ...
INFO: Executing pre_seed_input if any ...
INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes
Matching objects by name , *ac97-nam*, *ac97-nabm*
This process will fuzz the following MemoryRegions:
  * ac97-nabm[0] (size 100)
  * ac97-nam[0] (size 400)
This process will fuzz through the following interfaces:
  * clock_step, EVENT_TYPE_CLOCK_STEP, 0xffffffff +0xffffffff, 255,255
  * socket_write, EVENT_TYPE_SOCKET_WRITE, 0xffffffff +0xffffffff, 255,255
  * ac97-nam, EVENT_TYPE_PIO_READ, 0xc400 +0x400, 1,4
  * ac97-nam, EVENT_TYPE_PIO_WRITE, 0xc400 +0x400, 1,4
  * ac97-nabm, EVENT_TYPE_PIO_READ, 0xc800 +0x100, 1,4
  * ac97-nabm, EVENT_TYPE_PIO_WRITE, 0xc800 +0x100, 1,4
INFO: A corpus is not provided, starting from an empty corpus
#2      INITED cov: 7 ft: 8 corp: 1/1b exec/s: 0 rss: 205Mb
Running: /home/liuqiang/virtfuzz-bugs/metadata/ac97-00/crash-ae133515f9fb85d186cf23e010a00f1cba61b366
A bug was just triggered in audio_calloc
Save all your work and restart without audio
I am sorry
Context:
==8121== ERROR: libFuzzer: deadly signal
    #0 0x560b570b1678 in __sanitizer_print_stack_trace /root/llvm-project/compiler-rt/lib/asan/asan_stack.cpp:86
    #1 0x560b5700c032 in fuzzer::PrintStackTrace() /root/llvm-project/compiler-rt/lib/fuzzer/FuzzerUtil.cpp:210
    #2 0x560b56fbf0a0 in fuzzer::Fuzzer::CrashCallback() (.part.288) /root/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:235
    #3 0x560b56fe514c in fuzzer::Fuzzer::CrashCallback() /root/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:207
    #4 0x560b56fe514c in fuzzer::Fuzzer::StaticCrashSignalCallback() /root/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:206
    #5 0x7f44ef70f97f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1297f)
    #6 0x7f44eed26fb6 in __libc_signal_restore_set /build/glibc-S9d2JN/glibc-2.27/signal/../sysdeps/unix/sysv/linux/nptl-signals.h:80
    #7 0x7f44eed26fb6 in raise /build/glibc-S9d2JN/glibc-2.27/signal/../sysdeps/unix/sysv/linux/raise.c:48
    #8 0x7f44eed28920 in abort /build/glibc-S9d2JN/glibc-2.27/stdlib/abort.c:79
    #9 0x560b573566ba in audio_bug /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../audio/audio.c:120:9
    #10 0x560b57356a9f in audio_calloc /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../audio/audio.c:155:9
    #11 0x560b573bf280 in audio_pcm_sw_alloc_resources_out /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../audio/audio_template.h:115:15
    #12 0x560b573611f6 in audio_pcm_sw_init_out /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../audio/audio_template.h:174:11
    #13 0x560b5735c361 in AUD_open_out /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../audio/audio_template.h:498:13
    #14 0x560b579feb15 in open_voice /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../hw/audio/ac97.c:387:27
    #15 0x560b579fd0df in nam_writew /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../hw/audio/ac97.c:647:13
    #16 0x560b579fc0a7 in nam_write /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../hw/audio/ac97.c:1261:9
    #17 0x560b59642560 in memory_region_write_accessor /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../softmmu/memory.c:492:5
    #18 0x560b59641ae6 in access_with_adjusted_size /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../softmmu/memory.c:554:18
    #19 0x560b5963fa28 in memory_region_dispatch_write /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../softmmu/memory.c:1514:16
    #20 0x560b595f6519 in flatview_write_continue /home/liuqiang/videzzo/videzzo_qemu/qemu/build-san-6/../softmmu/physmem.c:2782:23
```

### Reproducer steps

1. Please check the attachment and run: qemu-fuzz-i386-target-videzzo-fuzz-ac97 crash-ae133515f9fb85d186cf23e010a00f1cba61b366

## Contact

Let us know if I need to provide more information.
